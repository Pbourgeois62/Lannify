{% extends 'event/partials/_event_layout.html.twig' %}

{% block title %}{{ event.name }}{% endblock %}

{% block event_layout %}

{# -------- Hero Countdown -------- #}
<section id="countdown-section" class="relative w-full py-24 text-center" data-aos="fade-up">

    {% if date() < event.startDate %}
    <div class="relative z-10 container mx-auto px-6 max-w-4xl">
        <h1 class="text-4xl md:text-6xl font-extrabold text-neonBlue drop-shadow-lg mb-10">
            La LAN débute dans…
        </h1>

        <div id="countdown" class="grid grid-cols-2 sm:grid-cols-4 gap-6 text-4xl md:text-6xl font-extrabold text-white pt-12" data-aos="zoom-in">
  {% for label in ['Jours','Heures','Minutes','Secondes'] %}
      <div class="countdown-card">
          <span id="{{ label|lower }}" class="block text-3xl md:text-4xl font-extrabold">00</span>
          <span class="text-sm mt-2 font-medium text-cyanShadow">{{ label }}</span>
      </div>
  {% endfor %}
</div>

    </div>
    {% else %}
    <div class="relative z-10 container mx-auto px-6 max-w-4xl">
        <h1 class="text-4xl md:text-6xl font-extrabold text-neonBlue drop-shadow-lg mb-10">
            La LAN a commencé !
        </h1>
    </div>
    {% endif %}
</section>

{# -------- Event Info -------- #}
<section id="infos-section" class="relative py-20 text-white" data-aos="fade-up">
    <div class="container mx-auto px-6 max-w-5xl">

        <div class="grid md:grid-cols-2 gap-10 bg-white/10 backdrop-blur-md p-8 rounded-2xl border border-cyanShadow shadow-xl transition-all duration-300 hover:shadow-neonBlue/40 hover:scale-[1.02]">

            {# Infos principales #}
            <div class="space-y-6" data-aos="fade-right">
                <h2 class="text-neonBlue text-2xl font-bold mb-4">Informations</h2>
                <p><strong class="text-cyanShadow">Date de début :</strong> {{ event.startDate|date('d/m/Y H:i') }}</p>
                <p><strong class="text-cyanShadow">Date de fin :</strong> {{ event.endDate|date('d/m/Y H:i') }}</p>
                {% if event.organizer %}
                    <p><strong class="text-cyanShadow">Organisateur :</strong> {{ event.organizer.profile.nickname ?? event.organizer.email }}</p>
                {% endif %}
            </div>

            {# Adresse #}
            {% if event.address %}
            <div class="space-y-6" data-aos="fade-left">
                <h2 class="text-neonBlue text-2xl font-bold mb-4">Adresse</h2>
                <p>{{ event.address.street }}</p>
                <p>{{ event.address.postalCode }} {{ event.address.city }}</p>
                <p>{{ event.address.country }}</p>
            </div>
            {% endif %}

        </div>
    </div>
</section>

{# -------- Participants -------- #}
<section id="participants-section" class="relative py-20 text-white" data-aos="fade-up">
    <div class="container mx-auto px-6 max-w-6xl text-center">
        <h2 class="text-3xl md:text-4xl font-extrabold text-neonBlue mb-12">Participants</h2>

        {% if event.users is not empty %}
        <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-8">
            {% for user in event.users %}
            <div class="p-4 rounded-xl bg-white/10 backdrop-blur-md border border-cyanShadow/30 flex flex-col items-center shadow-md transition-all duration-300 hover:scale-105 hover:shadow-neonBlue" data-aos="flip-left" data-aos-delay="{{ loop.index * 80 }}">
							<img src="{{ vich_uploader_asset(app.user.profile.avatar, 'imageFile') }}" alt="avatar" class="w-24 h-24 object-cover mb-3">
                <span class="text-sm font-medium text-cyanShadow">{{ user.profile.nickname ?? user.email }}</span>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p class="text-gray-400 italic mt-6">Aucun participant pour le moment.</p>
        {% endif %}
    </div>
</section>

{% block modals %}{% endblock %}

{# -------- Scripts -------- #}
<script>
    AOS.init({duration: 800, once: true, offset: 120, easing: 'ease-out-cubic'});

    const lanDate = new Date("{{ event.startDate|date('Y-m-d H:i:s') }}").getTime();

    function updateCountdown() {
        const now = new Date().getTime();
        const d = lanDate - now;
        const values = [
            Math.floor(d / (1000 * 60 * 60 * 24)),
            Math.floor((d % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)),
            Math.floor((d % (1000 * 60 * 60)) / (1000 * 60)),
            Math.floor((d % (1000 * 60)) / 1000)
        ];
        ['jours', 'heures', 'minutes', 'secondes'].forEach((id, i) => {
            const el = document.getElementById(id);
            if (el) el.textContent = values[i].toString().padStart(2, '0');
        });
    }

    const timer = setInterval(updateCountdown, 1000);
    updateCountdown();
</script>

{% endblock %}
