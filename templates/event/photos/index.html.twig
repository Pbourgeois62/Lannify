{% extends 'event/partials/_event_layout.html.twig' %}

{% block title %}Photos souvenirs de la LAN
	{{ event.name }}
{% endblock %}

{% block event_layout %}
	<h1 class="text-3xl font-extrabold text-neonBlue mb-12 text-center drop-shadow-lg">{{ event.name }}</h1>

	{# ---------------- CARROUSEL FLOWBITE (5 PHOTOS RANDOM) ---------------- #}
	<div id="carousel-event-photos" class="relative w-full" data-carousel="slide">
		<div class="relative h-64 md:h-96 overflow-hidden rounded-lg">
			{% for photo in photos %}
				<div data-carousel-item class="hidden duration-700 transform ease-in-out" {% if loop.first %} data-carousel-item-active {% endif %}>
					<img src="{{ asset('uploads/eventImages/' ~ photo.imageName) }}" class="absolute top-1/2 left-1/2 w-full h-full object-cover -translate-x-1/2 -translate-y-1/2 rounded-lg" alt="Photo de la LAN {{ event.name }}">
				</div>
			{% endfor %}
		</div>

		{# Slider indicators #}
		<div class="absolute z-30 flex -translate-x-1/2 bottom-5 left-1/2 space-x-3">
			{% for photo in photos %}
				<button type="button" class="w-3 h-3 rounded-full bg-gray-500/50 hover:bg-gray-300 transition-colors" aria-current="{{ loop.first ? 'true' : 'false' }}" aria-label="Slide {{ loop.index }}" data-carousel-slide-to="{{ loop.index0 }}"></button>
			{% endfor %}
		</div>

		{# Slider controls #}
		<button type="button" class="absolute top-0 left-0 z-30 flex items-center justify-center h-full px-4 cursor-pointer group" data-carousel-prev>
			<span class="inline-flex items-center justify-center w-10 h-10 rounded-full bg-black/50 group-hover:bg-black/70 text-white text-2xl">&#10094;</span>
		</button>
		<button type="button" class="absolute top-0 right-0 z-30 flex items-center justify-center h-full px-4 cursor-pointer group" data-carousel-next>
			<span class="inline-flex items-center justify-center w-10 h-10 rounded-full bg-black/50 group-hover:bg-black/70 text-white text-2xl">&#10095;</span>
		</button>
	</div>

	{# ---------------- GRILLE DES PHOTOS ---------------- #}
	<div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8 mt-12 text-white">
		{% for photo in photos %}
			<div class="relative rounded-lg overflow-hidden shadow-lg hover:shadow-2xl transition-shadow duration-300">

				<div
					class="absolute top-2 right-2 flex space-x-2 z-10">
					{# Bouton supprimer #}
					{% if app.user and (app.user == photo.uploadedBy or app.user == event.organizer) %}
						<button type="button" data-modal-target="delete-photo-{{ photo.id }}" data-modal-toggle="delete-photo-{{ photo.id }}" class="btn-delete">
							<i class="bi bi-trash"></i>
						</button>
					{% endif %}

					{# Ouvrir la photo dans un nouvel onglet #}
					<a href="{{ asset('uploads/eventImages/' ~ photo.imageName) }}" target="_blank" class="btn-edit">
						<i class="bi bi-arrows-fullscreen"></i>
					</a>

					{# Valider : seulement organizer et photo non approuvée #}
					{% if app.user and app.user == event.organizer and not photo.isApproved %}
						<a href="{{ path('event_photo_approve', {photo: photo.id, event: event.id}) }}" class="btn-view" onclick="return confirm('Approuver cette photo ?');" title="Approuver cette photo">
							<i class="bi bi-check-lg"></i>
						</a>
					{% endif %}
				</div>

				{# Image #}
				<img
				src="{{ asset('uploads/eventImages/' ~ photo.imageName) }}" alt="Photo de la LAN {{ event.name }}" class="w-full h-64 object-cover rounded-lg">

				{# Caption & infos #}
				<div class="p-4 bg-gray-800 space-y-2">
					<p class="text-sm text-gray-400">
						Ajoutée le
						{{ photo.createdAt|date('d/m/Y') }}
						par
						{% if photo.uploadedBy and photo.uploadedBy.profile and photo.uploadedBy.profile.nickname %}
							{{ photo.uploadedBy.profile.nickname }}
						{% else %}
							Anonyme
						{% endif %}
					</p>

					{% if photo.caption %}
						<p class="text-gray-200 mt-1">{{ photo.caption }}</p>
					{% endif %}
				</div>
			</div>

		{% else %}
			<p class="col-span-4 text-center text-gray-400">Aucune photo disponible pour le moment.</p>
		{% endfor %}
	</div>

	{# ---------------- BOUTON AJOUTER PHOTO ---------------- #}
	<div class="flex justify-center mt-12">
		<a href="{{ path('event_photo_add', {event: event.id}) }}" class="btn-primary px-3 py-1 text-base hover:scale-105 transform shadow-xl transition-all duration-300">
			➕ Ajouter une photo
		</a>
	</div>
{% endblock %}

{# ---------------- INJECTION DES MODALES ---------------- #}
{% block modals %}
	{% for photo in photos %}
		{% if app.user and (app.user == photo.uploadedBy or app.user == event.organizer) %}
			{% include 'event/photos/partials/_delete_photo_modal.html.twig' with { photo: photo } %}
            {# {% include 'event/photos/partials/_show_photo_modal.html.twig' with { photo: photo } %} #}
		{% endif %}
	{% endfor %}
{% endblock %}
