{% extends 'user/partials/_account_layout.html.twig' %}

{% block title %}Mon profil
{% endblock %}

{% block account_layout %}
	<div class="max-w-md mx-auto mt-12 p-6 bg-darkGrey rounded-xl shadow-2xl border-2 border-neonBlue">

		<h1 class="text-3xl font-extrabold text-neonBlue mb-6 text-center drop-shadow-lg">
			Modifier mon profil
		</h1>

		{{ form_start(form, {'attr': {'class': 'space-y-6'}}) }}

		{# Pseudo #}
		<div class="relative">
			{{ form_row(form.nickname, {
                'attr': {
                    'class': 'input text-white placeholder-gray-400 focus:ring-2 focus:ring-neonBlue focus:border-neonBlue'
                },
                'label_attr': {'class': 'block text-sm font-medium text-neonBlue mb-1'}
            }) }}
		</div>

		{# Avatar #}
		<div class="relative">
			{{ form_label(form.avatar, 'Avatar', {'label_attr': {'class': 'block text-sm font-medium text-neonBlue mb-1'}}) }}

			{# Avatar actuel (affichage classique) #}
			{% if form.vars.data and form.vars.data.avatar and form.vars.data.avatar.imageName %}
				<div class="flex items-center justify-center h-64">
					<img src="{{ asset('uploads/events/' ~ form.vars.data.avatar.imageName) }}" alt="Avatar actuel" class="w-auto max-h-64 mb-8">
				</div>

			{% endif %}


			{# Upload stylisé du sous-champ imageFile #}
			<div class="relative">
				{{ form_widget(form.avatar.imageFile, {            
            'label_attr': {'class': 'sr-only'}
        }) }}
			</div>

			{# Message d'erreur ou aide #}
			{% if form.avatar.vars.errors|length %}
				<p class="text-cyberPink text-sm mt-1">
					{{ form.avatar.vars.errors[0].message }}
				</p>
			{% else %}
				<p class="text-gray-400 text-xs mt-1">
					Taille max 2MB. Formats : jpg, png, webp, gif.
				</p>
			{% endif %}
		</div>

		{% if app.user.code is defined and app.user.code is not empty %}
            <div x-data="{ copied: false }" class="flex items-center gap-2">
                <p class="flex items-center gap-1">
                    <strong class="text-cyanShadow">Code LAN :</strong>
                    <span x-ref="code" class="text-electricPurple font-mono tracking-wide drop-shadow-[0_0_6px_#9f7aea]">
                        {{ app.user.code }}
                    </span>
                </p>
                <button @click="
                    if ($refs.code) {
                        navigator.clipboard.writeText($refs.code.textContent.trim());
                        copied = true;
                        setTimeout(() => copied = false, 2000);
                    }
                " class="flex items-center gap-1 text-xs px-2 py-1 rounded-md bg-cyan-600 hover:bg-cyan-700 text-white transition cursor-pointer">
                    <span x-show="!copied">Copier</span>
                    <span x-show="copied" x-transition class="inline-flex items-center gap-1">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7" />
                        </svg>
                        Copié !
                    </span>
                </button>
            </div>
        {% endif %}


		{# Bouton submit #}
		<button type="submit" class="btn-primary w-full">
			Sauvegarder
		</button>

		{{ form_end(form) }}
	</div>
{% endblock %}
