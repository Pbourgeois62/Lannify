{% extends 'game_session/partials/_game_session_layout.html.twig' %}

{% block title %}
	D√©tails de la session de jeu
{% endblock %}

{% block gameSession_layout %}
	<div class="container mx-auto p-4">

		{% if gameSession.description %}
			<h1 class="text-3xl font-extrabold text-neonBlue mb-4">
				{{ gameSession.description }}
			</h1>
		{% elseif gameSession.game.description_raw %}
			<h1 class="text-lg text-gray-300 mb-4">
				{{ gameSession.game.description_raw|raw }}
			</h1>
		{% endif %}

		<div
			class="flex flex-col lg:flex-row gap-6">
			{# --- Card principale du jeu --- #}
			<div class="bg-gray-900 rounded-lg shadow-lg overflow-hidden w-full lg:w-2/3 relative">
				{% if gameData.background_image is defined and gameData.background_image %}
					<img src="{{ gameData.background_image }}" alt="{{ gameData.name|default('Jeu sans nom') }}" class="w-full h-64 object-cover">
				{% else %}
					<div class="relative w-full h-64">
						<img
						src="{{ asset('images/default-game.webp') }}" alt="{{ gameData.name|default('Jeu sans nom') }}" class="w-full h-full object-cover brightness-50">

						{# Overlay + bouton centr√© #}
						<div class="absolute inset-0 flex items-center justify-center">
							<a href="{{ path('game_session_choose_game', { id: gameSession.id }) }}" class="bg-neonBlue text-black font-bold text-2xl rounded-full w-14 h-14 flex items-center justify-center shadow-lg hover:scale-110 hover:bg-neonBlue/80 transition-transform duration-200">
								<i class="bi bi-plus"></i>
							</a>
						</div>
					</div>
				{% endif %}

				<div class="p-4 flex flex-col gap-2">
					<p class="text-neonBlue font-semibold text-xl">
						{{ gameData.name|default('Aucun jeu s√©lectionn√©') }}
					</p>

					{% if gameData.released is defined and gameData.released %}
						<p class="text-gray-400 text-sm">
							üìÖ Date de sortie :
							{{ gameData.released }}
						</p>
					{% endif %}

					{% if gameData.rating is defined and gameData.rating %}
						<p class="text-gray-400 text-sm">
							‚≠ê
							{{ gameData.rating }}
						</p>
					{% endif %}

					{% if gameSession.game.genres is defined and gameSession.game.genres is not empty %}
						<div class="flex flex-wrap gap-2 mt-2">
							{% for genre in gameSession.game.genres %}
								<span class="text-sm bg-neonBlue/20 text-neonBlue px-2 py-1 rounded">
									{{ genre }}
								</span>
							{% endfor %}
						</div>
					{% endif %}

					{% if gameSession.game.platforms is defined and gameSession.game.platforms is not empty %}
						<div class="flex flex-wrap gap-2 mt-2">
							{% for platform in gameSession.game.platforms %}
								<span class="text-xs bg-gray-800 text-gray-200 px-2 py-1 rounded">
									{{ platform }}
								</span>
							{% endfor %}
						</div>
					{% endif %}
				</div>
			</div>


			{# Sidebar informations de session #}
			<div class="bg-gray-800 rounded-lg shadow-lg p-4 w-full lg:w-1/3 flex flex-col gap-2 space-around">
				<h1 class="text-neonBlue font-semibold text-lg mb-2">Infos g√©n√©rales</h1>
				<p class="text-gray-300 text-sm">D√©but :
					{{ gameSession.startDate|date('d/m/Y H:i') }}</p>
				<p class="text-gray-300 text-sm">
					‚è± Dur√©e estim√©e :
					{% if gameSession.estimatedDuration %}
						{{ (gameSession.estimatedDuration / 60)|number_format(1) }}
						h
					{% else %}
						Non pr√©cis√©e
					{% endif %}
				</p>

				{% if gameSession.isPrivate %}
					<p class="text-sm text-red-400 font-semibold">Groupe priv√©</p>
				{% endif %}

				<h1 class="text-neonBlue font-semibold text-lg mb-2">Participants:
					{{ gameSession.participants|length }}
					/ {{gameSession.maxParticipants}}</h1>

				<div class="flex flex-col flex-start space-y-2 mt-2">
					{% for participant in gameSession.participants %}
						<div class="flex items-center gap-3">
							<img src="{{ participant.profile.avatarPath }}" alt="Avatar de {{ participant.profile.nickName }}" class="rounded-full w-14 h-14 object-cover">
							<p class="text-neonBlue text-sm truncate max-w-xs text-center">
								{{ participant.profile.nickName }}
							</p>
						</div>
					{% endfor %}
				</div>

				<div
					class="flex flex-col space-y-2 mt-4 w-full gap-2 ">
					{# Boutons de partage de lien magique et code priv√© #}
					{% if gameSession.magicToken %}
						<div x-data="{ copied: false }" class="text-center">
							<button type="button" class="btn-secondary" :data-link="'{{ app.request.schemeAndHttpHost ~ path('event_join', { token: gameSession.magicToken }) }}'" @click="
																																																																								navigator.clipboard.writeText($el.dataset.link);
																																																																								copied = true;
																																																																								setTimeout(() => copied = false, 2000);
																																																																							">

								<span x-show="!copied" class="inline-flex items-center gap-2">
									<svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewbox="0 0 24 24" stroke="currentColor">
										<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 010 5.656l-2 2a4 4 0 01-5.656-5.656l1-1M10.172 13.828a4 4 0 010-5.656l2-2a4 4 0 015.656 5.656l-1 1"/>
									</svg>
									Partager le lien d‚Äôinvitation
								</span>

								<span x-show="copied" x-transition class="inline-flex items-center gap-1 text-neonBlue font-semibold">
									<svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewbox="0 0 24 24" stroke="currentColor">
										<path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"/>
									</svg>
									Lien copi√© !
								</span>
							</button>
						</div>
					{% endif %}
					{% if gameSession.isPrivate and gameSession.privateCode %}
						<div x-data="{ copied: false }" class="text-center mt-2">
							<button type="button" class="btn-secondary px-3 py-2" :data-code="'{{ gameSession.privateCode }}'" @click="
																																																					                    navigator.clipboard.writeText($el.dataset.code);
																																																					                    copied = true;
																																																					                    setTimeout(() => copied = false, 2000);
																																																					                ">
								<span x-show="!copied" class="inline-flex items-center gap-2">
									üîë Copier le code d‚Äôacc√®s
								</span>
								<span x-show="copied" x-transition class="inline-flex items-center gap-1 text-neonBlue font-semibold">
									‚úÖ Code copi√© !
								</span>
							</button>
						</div>
					{% endif %}
				</div>
			</div>
		</div>
	</div>
{% endblock %}
