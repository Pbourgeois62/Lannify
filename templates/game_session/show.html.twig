{% extends 'game_session/partials/_game_session_layout.html.twig' %}

{% block title %}
	D√©tails de la session de jeu
{% endblock %}

{% block gameSession_layout %}
	<div class="container mx-auto p-4">
		<div
			class="flex flex-col lg:flex-row gap-6">

			{# --- Card principale du jeu --- #}
			<div class="bg-gray-900 rounded-lg shadow-lg overflow-hidden w-full lg:w-2/3 relative">
				{% if gameData.background_image is defined and gameData.background_image %}
					<img src="{{ gameData.background_image }}" alt="{{ gameData.name|default('Jeu sans nom') }}" class="w-full h-64 object-cover">
				{% else %}
					<div class="relative w-full h-64">
						<img src="{{ asset('images/default-game.webp') }}" alt="{{ gameData.name|default('Jeu sans nom') }}" class="w-full h-full object-cover brightness-50">
						<div class="absolute inset-0 flex items-center justify-center">
							<a href="{{ path('game_session_choose_game', { id: gameSession.id }) }}" class="bg-neonBlue text-black font-bold text-2xl rounded-full w-14 h-14 flex items-center justify-center shadow-lg hover:scale-110 hover:bg-neonBlue/80 transition-transform duration-200">
								<i class="bi bi-plus"></i>
							</a>
						</div>
					</div>
				{% endif %}

				<div class="p-4 flex flex-col gap-2">
					<p class="text-neonBlue font-semibold text-xl">{{ gameData.name|default('Aucun jeu s√©lectionn√©') }}</p>
					{# Description ou description du jeu #}
					{% if gameSession.description %}
						<h1 class="text-3xl font-extrabold text-neonBlue mb-4">
							{{ gameSession.description }}
						</h1>					
					{% endif %}
					{% if gameData.released is defined and gameData.released %}
						<p class="text-gray-400 text-sm">üìÖ Date de sortie :
							{{ gameData.released }}</p>
					{% endif %}

					{% if gameData.rating is defined and gameData.rating %}
						<p class="text-gray-400 text-sm">‚≠ê
							{{ gameData.rating }}</p>
					{% endif %}

					{% if gameSession.game.genres is defined and gameSession.game.genres is not empty %}
						<div class="flex flex-wrap gap-2 mt-2">
							{% for genre in gameSession.game.genres %}
								<span class="text-sm bg-neonBlue/20 text-neonBlue px-2 py-1 rounded">{{ genre }}</span>
							{% endfor %}
						</div>
					{% endif %}

					{% if gameSession.game.platforms is defined and gameSession.game.platforms is not empty %}
						<div class="flex flex-wrap gap-2 mt-2">
							{% for platform in gameSession.game.platforms %}
								<span class="text-xs bg-gray-800 text-gray-200 px-2 py-1 rounded">{{ platform }}</span>
							{% endfor %}
						</div>
					{% endif %}
				</div>
			</div>

			{# --- Sidebar informations de session --- #}
			<div class=" p-4 w-full lg:w-1/3 flex flex-col gap-4">

				<div>
					<h2 class="text-neonBlue font-semibold text-lg mb-2">Infos g√©n√©rales</h2>
					<p class="text-gray-300 text-sm">D√©but :
						{{ gameSession.startDate|date('d/m/Y H:i') }}</p>
					<p class="text-gray-300 text-sm">‚è± Dur√©e estim√©e :
						{% if gameSession.estimatedDuration %}
							{{ (gameSession.estimatedDuration / 60)|number_format(1) }}
							h
						{% else %}
							Non pr√©cis√©e
						{% endif %}
					</p>
					{% if gameSession.isPrivate %}
						<p class="text-sm text-red-400 font-semibold">Groupe priv√©</p>
					{% endif %}
				</div>

				<div>
					<h2 class="text-neonBlue font-semibold text-lg mb-2">
						Participants:
						{{ gameSession.participants|length }}
						/
						{{ gameSession.maxParticipants }}
					</h2>

					<div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 max-h-80 overflow-y-auto custom-scrollbar p-1">
						{% for participant in gameSession.participants %}
							<div class="flex flex-col items-center">
								<img src="{{ participant.profile.avatarPath }}" alt="Avatar de {{ participant.profile.nickName }}" class="rounded-full w-14 h-14 object-cover">
								<p class="text-neonBlue text-xs truncate text-center">{{ participant.profile.nickName }}</p>
							</div>
						{% endfor %}
					</div>
				</div>

				<div class="flex flex-col gap-2 mt-4">
					{% if gameSession.magicToken %}
						<div x-data="{ copied: false }" class="text-center">
							<button type="button" class="btn-secondary w-full" :data-link="'{{ app.request.schemeAndHttpHost ~ path('game_session_join', { token: gameSession.magicToken }) }}'" @click="
																																				                            navigator.clipboard.writeText($el.dataset.link);
																																				                            copied = true;
																																				                            setTimeout(() => copied = false, 2000);
																																				                        ">
								<span x-show="!copied" class="inline-flex items-center gap-2">üìé Partager le lien</span>
								<span x-show="copied" x-transition class="inline-flex items-center gap-1 text-neonBlue font-semibold">‚úÖ Copi√© !</span>
							</button>
						</div>
					{% endif %}

					{% if gameSession.isPrivate and gameSession.privateCode %}
						<div x-data="{ copied: false }" class="text-center">
							<button type="button" class="btn-secondary w-full" :data-code="'{{ gameSession.privateCode }}'" @click="
																																				                            navigator.clipboard.writeText($el.dataset.code);
																																				                            copied = true;
																																				                            setTimeout(() => copied = false, 2000);
																																				                        ">
								<span x-show="!copied" class="inline-flex items-center gap-2">üîë Copier le code</span>
								<span x-show="copied" x-transition class="inline-flex items-center gap-1 text-neonBlue font-semibold">‚úÖ Copi√© !</span>
							</button>
						</div>
					{% endif %}
				</div>
			</div>
		</div>
	</div>
{% endblock %}
